/*! For license information please see 161.b41cb8d3.js.LICENSE.txt */
"use strict";(self.webpackChunkcommonjs=self.webpackChunkcommonjs||[]).push([[161],{"webpack/container/remote/qodly_6fa741d64953ed9604fa/components":(t,e,r)=>{r.r(e),r.d(e,{default:()=>Dt});var n=r("webpack/sharing/consume/default/@ws-ui/webform-editor"),o=r("webpack/container/remote/qodly_6fa741d64953ed9604fa/node_modules/react-icons/fa/index.esm.js");function a(t){return function(t){if(Array.isArray(t))return i(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return i(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}var u=[{key:"zoom",label:"Zoom",type:n.ESetting.NUMBER_FIELD,defaultValue:10},{key:"mapDragging",label:"Map dragging",type:n.ESetting.CHECKBOX,defaultValue:!0},{key:"marker",label:"Marker",type:n.ESetting.CHECKBOX,defaultValue:!0},{key:"popup",label:"Popup",type:n.ESetting.CHECKBOX,defaultValue:!1},{key:"markerDragging",label:"Marker dragging",type:n.ESetting.CHECKBOX,defaultValue:!1},{key:"icon",label:"Marker Icon",type:n.ESetting.ICON_PICKER,defaultValue:"fa-solid fa-location-dot"}],c=[{key:"datasource",label:"Qodly Source",type:n.ESetting.DS_AUTO_SUGGEST},{key:"long",label:"Longitude",type:n.ESetting.DS_AUTO_SUGGEST,datasourceProperty:"datasource"},{key:"lat",label:"Latitude",type:n.ESetting.DS_AUTO_SUGGEST,datasourceProperty:"datasource"},{key:"tooltip",label:"Tooltip",type:n.ESetting.DS_AUTO_SUGGEST,datasourceProperty:"datasource"},{key:"serverSideRef",label:"Server Side",type:n.ESetting.TEXT_FIELD,validateOnEnter:!0}],l=[{key:"properties",label:"Properties",type:n.ESetting.GROUP,components:u},{key:"dataAccess",label:"Data Access",type:n.ESetting.GROUP,components:c}].concat(a((0,n.load)(n.DEFAULT_SETTINGS).filter("style.overflow","font","background","dataAccess"))),s=[].concat(u,a((0,n.load)(n.BASIC_SETTINGS).filter("style.overflow","style.fontFamily","style.fontWeight","style.fontSize","style.textAlign","style.textTransform","background")));const f=l,p={craft:{displayName:"SingleMap",kind:n.EComponentKind.BASIC,props:{name:"",classNames:[],events:[]},related:{settings:(0,n.Settings)(f,s)}},info:{displayName:"SingleMap",exposed:!0,icon:o.vq8,events:[{label:"On Click",value:"onclick"},{label:"On Blur",value:"onblur"},{label:"On Focus",value:"onfocus"},{label:"On MouseEnter",value:"onmouseenter"},{label:"On MouseLeave",value:"onmouseleave"},{label:"On KeyDown",value:"onkeydown"},{label:"On KeyUp",value:"onkeyup"}],datasources:{declarations:function(t){var e=t.lat,r=t.long,o=t.datasource,a=void 0===o?"":o,i=[{path:a,iterable:!0}];if(e&&r){if(!((0,n.splitDatasourceID)(null==a?void 0:a.trim())||{}).id)return;var u=(0,n.splitDatasourceID)(e).id;i.push({path:"".concat(a,".[].").concat(u)});var c=(0,n.splitDatasourceID)(r).id;i.push({path:"".concat(a,".[].").concat(c)})}return i},accept:["object","entity"]}},defaultProps:{style:{height:"400px",width:"400px"},zoom:10,markerDragging:!1,popup:!1,mapDragging:!0,marker:!0,icon:"fa-solid fa-location-dot"}};var d=r("webpack/container/remote/qodly_6fa741d64953ed9604fa/node_modules/classnames/index.js"),y=r.n(d),h=r("webpack/sharing/consume/default/react"),v=r("webpack/container/remote/qodly_6fa741d64953ed9604fa/node_modules/leaflet/dist/leaflet-src.js"),m=r.n(v),g=(r("webpack/container/remote/qodly_6fa741d64953ed9604fa/node_modules/leaflet/dist/leaflet.css"),r("webpack/sharing/consume/default/react/jsx-runtime"));function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}const w=function(t){var e,r,o=t.popup,a=t.zoom,i=t.markerDragging,u=t.mapDragging,c=t.icon,l=t.style,s=t.className,f=t.classNames,p=void 0===f?[]:f,d=(0,n.useEnhancedNode)().connectors.connect,v=(0,h.useRef)(null),w=(e=(0,h.useState)("fa-solid fa-map-pin"),r=2,function(t){if(Array.isArray(t))return t}(e)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,a,i,u=[],c=!0,l=!1;try{if(a=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=a.call(r)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(t){l=!0,o=t}finally{try{if(!c&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return u}}(e,r)||function(t,e){if(t){if("string"==typeof t)return b(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?b(t,e):void 0}}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),S=w[0],E=w[1];return(0,h.useEffect)((function(){E(c)}),[c]),(0,h.useEffect)((function(){var t=null;if(v.current){t=m().map(v.current,{dragging:u}).setView([51.505,-.09],a),m().tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"}).addTo(t);var e=m().divIcon({html:'<i class="map_icon '.concat(S,'" style="font-size: 30px ; display: flex; align-items: center; justify-content: center; width: 32px; height: 42px"></i>'),className:"",iconAnchor:[13,33]}),r=m().marker([51.505,-.09],{draggable:i,icon:e}).addTo(t);o&&r.bindPopup("your message here",{offset:m().point(3,-10)}).openPopup()}return function(){t&&t.remove()}}),[a,i,o,u,S]),(0,g.jsx)("div",{ref:d,style:l,className:y()(s,p,"flex items-center justify-center overflow-hidden"),children:(0,g.jsx)("div",{ref:v,style:{width:"100%",height:"100%",zIndex:1},children:" "})})};function S(t){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},S(t)}function E(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return x(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?x(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return i=t.done,t},e:function(t){u=!0,a=t},f:function(){try{i||null==r.return||r.return()}finally{if(u)throw a}}}}function x(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function O(t,e){var r=[];return t.forEach((function(t){!function(t){for(var n=0,o=r;n<o.length;n++){var a,i=o[n],u=E(i);try{for(u.s();!(a=u.n()).done;){var c=a.value;if(s=t,void 0,void 0,void 0,void 0,void 0,f=(l=c).latitude*Math.PI/180,p=s.latitude*Math.PI/180,d=(s.latitude-l.latitude)*Math.PI/180,y=(s.longitude-l.longitude)*Math.PI/180,h=Math.sin(d/2)*Math.sin(d/2)+Math.cos(f)*Math.cos(p)*Math.sin(y/2)*Math.sin(y/2),2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h))*6371<=e)return i.push(t),i}}catch(t){u.e(t)}finally{u.f()}}var l,s,f,p,d,y,h,v=[t];r.push(v)}(t)})),r}function j(t,e){if(e){var r=function(t,e){if(0===e.length)return t;if(t&&"object"===S(t)){var n=e.shift();return r(t[n],e)}},n=e.split(".");return r(t,n)}}var k=function(t,e,r,n,o){return r.findIndex((function(r){return n&&o?+r[o]===e&&+r[n]===t:r.latitude===t&&r.longitude===e}))};function P(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function A(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?P(Object(r),!0).forEach((function(e){_(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):P(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function _(t,e,r){return(e=function(t){var e=function(t){if("object"!=I(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=I(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==I(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function I(t){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},I(t)}function D(){D=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function l(e,r,n,o){var a=r&&r.prototype instanceof p?r:p,i=Object.create(a.prototype);return c(i,"_invoke",function(e,r,n){var o=1;return function(a,i){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===a)throw i;return{value:t,done:!0}}for(n.method=a,n.arg=i;;){var u=n.delegate;if(u){var c=S(u,n);if(c){if(c===f)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var l=s(e,r,n);if("normal"===l.type){if(o=n.done?4:2,l.arg===f)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=4,n.method="throw",n.arg=l.arg)}}}(e,n,new O(o||[])),!0),i}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var f={};function p(){}function d(){}function y(){}var h={};c(h,a,(function(){return this}));var v=Object.getPrototypeOf,m=v&&v(v(j([])));m&&m!==r&&n.call(m,a)&&(h=m);var g=y.prototype=p.prototype=Object.create(h);function b(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function r(o,a,i,u){var c=s(t[o],t,a);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==I(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,i,u)}),(function(t){r("throw",t,i,u)})):e.resolve(f).then((function(t){l.value=t,i(l)}),(function(t){return r("throw",t,i,u)}))}u(c.arg)}var o;c(this,"_invoke",(function(t,n){function a(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(a,a):a()}),!0)}function S(e,r){var n=r.method,o=e.i[n];if(o===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,S(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var a=s(o,e.i,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,f;var i=a.arg;return i?i.done?(r[e.r]=i.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,f):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,f)}function E(t){this.tryEntries.push(t)}function x(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function O(t){this.tryEntries=[[-1]],t.forEach(E,this),this.reset(!0)}function j(e){if(null!=e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(I(e)+" is not iterable")}return d.prototype=y,c(g,"constructor",y),c(y,"constructor",d),d.displayName=c(y,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,c(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},b(w.prototype),c(w.prototype,i,(function(){return this})),e.AsyncIterator=w,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new w(l(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},b(g),c(g,u,"Generator"),c(g,a,(function(){return this})),c(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.values=j,O.prototype={constructor:O,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(x),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){i.type="throw",i.arg=e,r.next=t}for(var o=r.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a[4],u=this.prev,c=a[1],l=a[2];if(-1===a[0])return n("end"),!1;if(!c&&!l)throw Error("try statement without catch or finally");if(null!=a[0]&&a[0]<=u){if(u<c)return this.method="next",this.arg=t,n(c),!0;if(u<l)return n(l),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var a=o?o[4]:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o[2],f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),x(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;x(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:j(e),r,n},"next"===this.method&&(this.arg=t),f}},e}function T(t,e,r,n,o,a,i){try{var u=t[a](i),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function M(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(t){T(a,n,o,i,u,"next",t)}function u(t){T(a,n,o,i,u,"throw",t)}i(void 0)}))}}function N(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,a,i,u=[],c=!0,l=!1;try{if(a=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=a.call(r)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(t){l=!0,o=t}finally{try{if(!c&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return u}}(t,e)||G(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function G(t,e){if(t){if("string"==typeof t)return C(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?C(t,e):void 0}}function C(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}const U=function(t){var e=t.popup,r=t.zoom,o=t.markerDragging,a=t.mapDragging,i=t.marker,u=t.long,c=t.lat,l=t.icon,s=t.tooltip,f=t.style,p=t.className,d=t.classNames,v=void 0===d?[]:d,b=(0,n.useRenderer)().connect,w=N((0,h.useState)(),2),S=w[0],E=w[1],x=N((0,h.useState)({width:null==f?void 0:f.width,height:null==f?void 0:f.height}),2),O=x[0],k=x[1],P=N((0,h.useState)(!1),2),_=P[0],T=P[1],C=N((0,h.useState)(!1),2),U=C[0],L=C[1],R=(0,h.useRef)(null),F=(0,n.splitDatasourceID)(u).id;u=F;var z=(0,n.splitDatasourceID)(c).id;c=z;var V=(0,n.splitDatasourceID)(s).id;s=V,console.log(u,c);var B=(0,n.useSources)().sources.datasource;(0,h.useEffect)((function(){if(B){var t=function(){var t=M(D().mark((function t(){var e;return D().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,B.getValue();case 2:j(e=t.sent,u)&&j(e,c)&&(E({longitude:+j(e,u),latitude:+j(e,c),popupMessage:j(e,s)}),T(!0));case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return t(),B.addListener("changed",t),function(){B.removeListener("changed",t)}}}),[]);var q,K=(0,h.useRef)(null),X=(0,h.useRef)(null),H=(0,h.useRef)(null),$=m().divIcon({html:'<i class="map_icon '.concat(l,'" style="font-size: 30px ; display: flex; align-items: center; justify-content: center; width: 32px; height: 42px"></i>'),className:"",iconAnchor:[13,33]});return(0,h.useEffect)((function(){if(K.current&&(X.current=m().map(K.current,{dragging:a}).setView([S.latitude,S.longitude],r),K.current.addEventListener("mousedown",(function(t){t.stopPropagation()})),m().tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"}).addTo(X.current),i)){if(H.current=m().marker([+S.latitude,+S.longitude],{icon:$,draggable:o}).addTo(X.current),e){var t=S.popupMessage;H.current.bindPopup(t,{offset:m().point(3,-10)})}H.current.on("moveend",(function(t){var e=t.target.getLatLng();E({longitude:e.lng,latitude:e.lat,popupMessage:S.popupMessage}),L(!0)})),H.current.on("mousedown",(function(t){var e;null===(e=t.originalEvent)||void 0===e||e.stopPropagation()}))}return function(){var t;X&&(null===(t=X.current)||void 0===t||t.remove())}}),[r,O,X,_]),(0,h.useEffect)((function(){if(S&&U){var t=function(){var t=M(D().mark((function t(){var e,r;return D().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=function(t,e,r){for(var n=e.split("."),o=t,a=0;a<n.length-1;a++)void 0===(o=o[n[a]])&&(o={});o[n[n.length-1]]=r},t.next=3,B.getValue();case 3:e=t.sent,r(e,u,S.longitude),r(e,c,S.latitude),B.setValue(null,e);case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();t(),L(!1)}}),[U]),(0,h.useEffect)((function(){var t,r;if(!U&&(null===(t=X.current)||void 0===t||t.flyTo([S.latitude,S.longitude]),X.current&&i&&(null===(r=H.current)||void 0===r||r.setLatLng({lat:S.latitude,lng:S.longitude}),e))){var n,o=S.popupMessage;null===(n=H.current)||void 0===n||n.bindPopup(o)}}),[S]),(0,h.useEffect)((function(){var t=new ResizeObserver((function(t){var e,r=function(t){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=G(t))){e&&(t=e);var r=0,n=function(){};return{s:n,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,i=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return a=t.done,t},e:function(t){i=!0,o=t},f:function(){try{a||null==e.return||e.return()}finally{if(i)throw o}}}}(t);try{for(r.s();!(e=r.n()).done;){var n=e.value.contentRect,o=n.width,a=n.height;k({width:o,height:a})}}catch(t){r.e(t)}finally{r.f()}}));return R.current&&t.observe(R.current),function(){R.current&&t.unobserve(R.current)}}),[]),(0,g.jsx)("div",{ref:b,style:f,className:y()(p,v,"flex items-center justify-center  overflow-hidden"),children:(q=S,"object"==I(q)&&!Array.isArray(q)&&"latitude"in q&&"longitude"in q?(0,g.jsx)("div",{ref:K,style:A(A({},O),{},{zIndex:1})}):(0,g.jsxs)("div",{className:"bg-red-50 border border-red-300 text-red-700 px-4 py-3 rounded-lg shadow-md",role:"alert",children:[(0,g.jsx)("div",{className:"flex items-center",children:(0,g.jsx)("strong",{className:"font-bold text-red-700",children:"Error!"})}),(0,g.jsx)("span",{className:"block sm:inline mt-1 ",children:"Datasource does not match the expected format."})]}))})};function L(t){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},L(t)}function R(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function F(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?R(Object(r),!0).forEach((function(e){z(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):R(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function z(t,e,r){return(e=function(t){var e=function(t){if("object"!=L(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=L(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==L(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var V=function(t){return(0,n.useEnhancedEditor)((function(t){return{enabled:t.options.enabled}})).enabled?(0,g.jsx)(w,F({},t)):(0,g.jsx)(U,F({},t))};V.craft=p.craft,V.info=p.info,V.defaultProps=p.defaultProps;const B=V;var q=r("webpack/container/remote/qodly_6fa741d64953ed9604fa/node_modules/react-icons/tb/index.esm.js");function K(t){return function(t){if(Array.isArray(t))return X(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return X(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?X(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function X(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}var H=[{key:"zoom",label:"Zoom",type:n.ESetting.NUMBER_FIELD,defaultValue:-1},{key:"showAllMarkers",label:"Show All Markers",type:n.ESetting.CHECKBOX,defaultValue:!1},{key:"mapDragging",label:"Map dragging",type:n.ESetting.CHECKBOX,defaultValue:!0},{key:"animation",label:"Animation",type:n.ESetting.CHECKBOX,defaultValue:!0},{key:"popup",label:"Popup",type:n.ESetting.CHECKBOX,defaultValue:!0},{key:"distance",label:"Marker group distance (Km)",type:n.ESetting.NUMBER_FIELD,defaultValue:100},{key:"icone",label:"Marker Icon",type:n.ESetting.ICON_PICKER,defaultValue:"fa-solid fa-location-dot"}],$=[{key:"datasource",label:"Qodly Source",type:n.ESetting.DS_AUTO_SUGGEST},{key:"currentElement",label:"current Position",type:n.ESetting.DS_AUTO_SUGGEST},{key:"long",label:"Longitude",type:n.ESetting.DS_AUTO_SUGGEST,datasourceProperty:"datasource"},{key:"lat",label:"Latitude",type:n.ESetting.DS_AUTO_SUGGEST,datasourceProperty:"datasource"},{key:"tooltip",label:"Tooltip",type:n.ESetting.DS_AUTO_SUGGEST,datasourceProperty:"datasource"},{key:"serverSideRef",label:"Server Side",type:n.ESetting.TEXT_FIELD,validateOnEnter:!0}],Z=[{key:"properties",label:"Properties",type:n.ESetting.GROUP,components:H},{key:"dataAccess",label:"Data Access",type:n.ESetting.GROUP,components:$}].concat(K((0,n.load)(n.DEFAULT_SETTINGS).filter("style.overflow","font","background","dataAccess"))),W=[].concat(H,K((0,n.load)(n.BASIC_SETTINGS).filter("style.overflow","style.fontFamily","style.fontWeight","style.fontSize","style.textAlign","style.textTransform","background")));const Y=Z,Q={craft:{displayName:"MultiMap",kind:n.EComponentKind.BASIC,props:{name:"",classNames:[],events:[]},related:{settings:(0,n.Settings)(Y,W)}},info:{displayName:"MultiMap",exposed:!0,icon:q.I5J,events:[{label:"On Click",value:"onclick"},{label:"On Blur",value:"onblur"},{label:"On Focus",value:"onfocus"},{label:"On MouseEnter",value:"onmouseenter"},{label:"On MouseLeave",value:"onmouseleave"},{label:"On KeyDown",value:"onkeydown"},{label:"On KeyUp",value:"onkeyup"}],datasources:{declarations:function(t){var e=t.lat,r=t.long,o=t.tooltip,a=t.datasource,i=void 0===a?"":a,u=[{path:i,iterable:!0}];if(e&&r){if(!((0,n.splitDatasourceID)(null==i?void 0:i.trim())||{}).id)return;var c=(0,n.splitDatasourceID)(e).id;u.push({path:"".concat(i,".[].").concat(c)});var l=(0,n.splitDatasourceID)(r).id;u.push({path:"".concat(i,".[].").concat(l)});var s=(0,n.splitDatasourceID)(o).id;u.push({path:"".concat(i,".[].").concat(s)})}return u},accept:["entitySel","array"]}},defaultProps:{style:{height:"400px",width:"400px"},zoom:10,showAllMarkers:!1,animation:!0,popup:!0,mapDragging:!0,distance:100,icone:"fa-solid fa-location-dot"}};function J(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}r("webpack/container/remote/qodly_6fa741d64953ed9604fa/node_modules/leaflet.markercluster/dist/leaflet.markercluster-src.js"),r("webpack/container/remote/qodly_6fa741d64953ed9604fa/node_modules/leaflet.markercluster/dist/MarkerCluster.css"),r("webpack/container/remote/qodly_6fa741d64953ed9604fa/node_modules/leaflet.markercluster/dist/MarkerCluster.Default.css");const tt=function(t){var e,r,o=t.zoom,a=t.mapDragging,i=t.style,u=t.icone,c=t.className,l=t.classNames,s=void 0===l?[]:l,f=(0,n.useEnhancedNode)().connectors.connect,p=(0,h.useRef)(null),d=(e=(0,h.useState)("fa-solid fa-map-pin"),r=2,function(t){if(Array.isArray(t))return t}(e)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,a,i,u=[],c=!0,l=!1;try{if(a=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=a.call(r)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(t){l=!0,o=t}finally{try{if(!c&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return u}}(e,r)||function(t,e){if(t){if("string"==typeof t)return J(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?J(t,e):void 0}}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),v=d[0],b=d[1];return(0,h.useEffect)((function(){b(u)}),[u]),(0,h.useEffect)((function(){var t=null;if(p.current){t=m().map(p.current,{dragging:a}).setView([51.505,-.09],o),m().tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"}).addTo(t);var e=m().divIcon({html:'<i class="map_icon '.concat(v,'" style="font-size: 30px ; display: flex; align-items: center; justify-content: center; width: 32px; height: 42px"></i>'),className:"",iconAnchor:[13,33]}),r=m().markerClusterGroup();r.addLayer(m().marker([51.505,-.09],{icon:e})),r.addLayer(m().marker([51.505,-.13],{icon:e})),r.addLayer(m().marker([51.505,-.2],{icon:e})),t.addLayer(r)}return function(){t&&t.remove()}}),[o,a,i,v]),(0,g.jsx)("div",{ref:f,style:i,className:y()(c,s,"flex items-center justify-center overflow-hidden"),children:(0,g.jsx)("div",{ref:p,style:{width:"100%",height:"100%",zIndex:1}})})};var et=r("webpack/container/remote/qodly_6fa741d64953ed9604fa/node_modules/lodash/findIndex.js"),rt=r.n(et),nt=r("webpack/container/remote/qodly_6fa741d64953ed9604fa/node_modules/lodash/isEqual.js"),ot=r.n(nt);function at(t){return at="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},at(t)}function it(t){return function(t){if(Array.isArray(t))return ut(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return ut(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ut(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ut(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function ct(){ct=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function l(e,r,n,o){var a=r&&r.prototype instanceof p?r:p,i=Object.create(a.prototype);return c(i,"_invoke",function(e,r,n){var o=1;return function(a,i){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===a)throw i;return{value:t,done:!0}}for(n.method=a,n.arg=i;;){var u=n.delegate;if(u){var c=S(u,n);if(c){if(c===f)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var l=s(e,r,n);if("normal"===l.type){if(o=n.done?4:2,l.arg===f)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=4,n.method="throw",n.arg=l.arg)}}}(e,n,new O(o||[])),!0),i}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var f={};function p(){}function d(){}function y(){}var h={};c(h,a,(function(){return this}));var v=Object.getPrototypeOf,m=v&&v(v(j([])));m&&m!==r&&n.call(m,a)&&(h=m);var g=y.prototype=p.prototype=Object.create(h);function b(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function r(o,a,i,u){var c=s(t[o],t,a);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==at(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,i,u)}),(function(t){r("throw",t,i,u)})):e.resolve(f).then((function(t){l.value=t,i(l)}),(function(t){return r("throw",t,i,u)}))}u(c.arg)}var o;c(this,"_invoke",(function(t,n){function a(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(a,a):a()}),!0)}function S(e,r){var n=r.method,o=e.i[n];if(o===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,S(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var a=s(o,e.i,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,f;var i=a.arg;return i?i.done?(r[e.r]=i.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,f):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,f)}function E(t){this.tryEntries.push(t)}function x(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function O(t){this.tryEntries=[[-1]],t.forEach(E,this),this.reset(!0)}function j(e){if(null!=e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(at(e)+" is not iterable")}return d.prototype=y,c(g,"constructor",y),c(y,"constructor",d),d.displayName=c(y,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,c(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},b(w.prototype),c(w.prototype,i,(function(){return this})),e.AsyncIterator=w,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new w(l(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},b(g),c(g,u,"Generator"),c(g,a,(function(){return this})),c(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.values=j,O.prototype={constructor:O,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(x),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){i.type="throw",i.arg=e,r.next=t}for(var o=r.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a[4],u=this.prev,c=a[1],l=a[2];if(-1===a[0])return n("end"),!1;if(!c&&!l)throw Error("try statement without catch or finally");if(null!=a[0]&&a[0]<=u){if(u<c)return this.method="next",this.arg=t,n(c),!0;if(u<l)return n(l),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var a=o?o[4]:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o[2],f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),x(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;x(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:j(e),r,n},"next"===this.method&&(this.arg=t),f}},e}function lt(t,e,r,n,o,a,i){try{var u=t[a](i),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function st(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(t){lt(a,n,o,i,u,"next",t)}function u(t){lt(a,n,o,i,u,"throw",t)}i(void 0)}))}}function ft(t){return pt.apply(this,arguments)}function pt(){return(pt=st(ct().mark((function t(e){var r,n,o,a,i,u,c,l,s,f,p,d;return ct().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.index,n=e.newIndex,o=e.datasource,a=e.currentElement,i=e.fireEvent,u=void 0===i||i,c=e.onBeforeUpdate,l=o.entitysel){t.next=4;break}return t.abrupt("return");case 4:if(!(r>=0)){t.next=10;break}return t.next=7,l.getEntity(r);case 7:t.t0=t.sent,t.next=11;break;case 10:t.t0=null;case 11:return s=t.t0,f=!(!o||!a)&&o.namespace!==a.namespace,p=!a.parentSource||f,null==c||c(),t.next=17,a.setValue(null,s,!p&&u);case 17:if(void 0!==n&&(null===(d=a.entity)||void 0===d||d.setPos(n)),!p){t.next=21;break}return t.next=21,dt(a,s);case 21:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function dt(t,e){return yt.apply(this,arguments)}function yt(){return yt=st(ct().mark((function t(e,r){var n,o,a,i=arguments;return ct().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=!(i.length>2&&void 0!==i[2])||i[2],!r){t.next=11;break}if(o=e.filterAttributesText.split(",").filter(Boolean),a=(r._private.filterAttributes||"").split(",").filter(Boolean),ot()(o,a)){t.next=11;break}return e.filterAttributesText=Array.from(new Set([].concat(it(o),it(a)))).join(","),r._private.filterAttributes=e.filterAttributesText,r._private.inited=!1,t.next=10,r.fetch();case 10:r._private.inited=!0;case 11:return t.next=13,e.recomputeChildren(n);case 13:n&&e.fireEvent("changed");case 14:case"end":return t.stop()}}),t)}))),yt.apply(this,arguments)}function ht(t){return ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ht(t)}function vt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function mt(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?vt(Object(r),!0).forEach((function(e){gt(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):vt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function gt(t,e,r){return(e=function(t){var e=function(t){if("object"!=ht(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=ht(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==ht(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function bt(){bt=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function c(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function l(e,r,n,o){var a=r&&r.prototype instanceof p?r:p,i=Object.create(a.prototype);return c(i,"_invoke",function(e,r,n){var o=1;return function(a,i){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===a)throw i;return{value:t,done:!0}}for(n.method=a,n.arg=i;;){var u=n.delegate;if(u){var c=S(u,n);if(c){if(c===f)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var l=s(e,r,n);if("normal"===l.type){if(o=n.done?4:2,l.arg===f)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o=4,n.method="throw",n.arg=l.arg)}}}(e,n,new O(o||[])),!0),i}function s(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var f={};function p(){}function d(){}function y(){}var h={};c(h,a,(function(){return this}));var v=Object.getPrototypeOf,m=v&&v(v(j([])));m&&m!==r&&n.call(m,a)&&(h=m);var g=y.prototype=p.prototype=Object.create(h);function b(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){function r(o,a,i,u){var c=s(t[o],t,a);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==ht(f)&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,i,u)}),(function(t){r("throw",t,i,u)})):e.resolve(f).then((function(t){l.value=t,i(l)}),(function(t){return r("throw",t,i,u)}))}u(c.arg)}var o;c(this,"_invoke",(function(t,n){function a(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(a,a):a()}),!0)}function S(e,r){var n=r.method,o=e.i[n];if(o===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,S(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var a=s(o,e.i,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,f;var i=a.arg;return i?i.done?(r[e.r]=i.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,f):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,f)}function E(t){this.tryEntries.push(t)}function x(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function O(t){this.tryEntries=[[-1]],t.forEach(E,this),this.reset(!0)}function j(e){if(null!=e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(ht(e)+" is not iterable")}return d.prototype=y,c(g,"constructor",y),c(y,"constructor",d),d.displayName=c(y,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,c(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},b(w.prototype),c(w.prototype,i,(function(){return this})),e.AsyncIterator=w,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new w(l(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},b(g),c(g,u,"Generator"),c(g,a,(function(){return this})),c(g,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.values=j,O.prototype={constructor:O,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(x),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){i.type="throw",i.arg=e,r.next=t}for(var o=r.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],i=a[4],u=this.prev,c=a[1],l=a[2];if(-1===a[0])return n("end"),!1;if(!c&&!l)throw Error("try statement without catch or finally");if(null!=a[0]&&a[0]<=u){if(u<c)return this.method="next",this.arg=t,n(c),!0;if(u<l)return n(l),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var a=o?o[4]:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o[2],f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),x(r),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;x(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:j(e),r,n},"next"===this.method&&(this.arg=t),f}},e}function wt(t,e,r,n,o,a,i){try{var u=t[a](i),c=u.value}catch(t){return void r(t)}u.done?e(c):Promise.resolve(c).then(n,o)}function St(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(t){wt(a,n,o,i,u,"next",t)}function u(t){wt(a,n,o,i,u,"throw",t)}i(void 0)}))}}function Et(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,a,i,u=[],c=!0,l=!1;try{if(a=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=a.call(r)).done)&&(u.push(n.value),u.length!==e);c=!0);}catch(t){l=!0,o=t}finally{try{if(!c&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(l)throw o}}return u}}(t,e)||xt(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xt(t,e){if(t){if("string"==typeof t)return Ot(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ot(t,e):void 0}}function Ot(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}const jt=function(t){var e=t.popup,r=t.zoom,o=t.showAllMarkers,a=t.animation,i=t.mapDragging,u=t.distance,c=t.long,l=t.lat,s=t.tooltip,f=t.icone,p=t.style,d=t.className,v=t.classNames,b=void 0===v?[]:v,w=(0,n.useRenderer)().connect,E=Et((0,h.useState)({width:null!=p&&p.width?p.width:"100%",height:null==p?void 0:p.height}),2),x=E[0],P=E[1],A=(0,h.useRef)(null),_=(0,h.useRef)([]),I=Et((0,h.useState)([]),2),D=I[0],T=I[1],M=(0,h.useRef)(null),N=(0,h.useRef)(null),G=(0,h.useRef)(!1),C=(0,h.useRef)(!1),U=(0,n.splitDatasourceID)(c).id;c=U;var L=(0,n.splitDatasourceID)(l).id;l=L;var R=(0,n.splitDatasourceID)(s).id;s=R;var F=(0,n.useSources)({acceptIteratorSel:!0}).sources,z=F.datasource,V=F.currentElement,B=(0,n.useDataLoader)({source:z}),q=B.fetchIndex,K=B.query,X=B.loaderDatasource,H=m().divIcon({html:'<i class="map_icon '.concat(f,'" style="font-size: 30px ; display: flex; align-items: center; justify-content: center; width: 32px; height: 42px"></i>'),className:"",iconAnchor:[13,33]}),$=(0,h.useCallback)((function(t){if(N.current&&(t.length>0||D.length>0)){var r,n="scalar"===z.type?O(D,u):O(t,u);null===(r=N.current)||void 0===r||r.eachLayer((function(t){t instanceof m().TileLayer||t.remove()}));for(var i=m().markerClusterGroup(),s=[],f=0;f<n.length;f++){for(var p=0;p<n[f].length;p++){var d,y,h=m().marker([+(null===(d=n[f][p])||void 0===d?void 0:d.latitude),+(null===(y=n[f][p])||void 0===y?void 0:y.longitude)],{icon:H});if(n[f][p].popupMessage&&e){var v=n[f][p].popupMessage;h.bindPopup(v,{offset:m().point(3,-10)})}s.push(h),h.on("click",function(){var e=St(bt().mark((function e(r){var n,o,i,u,s,f;return bt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=r.latlng,i=o.lat,u=o.lng,"scalar"===z.type?(s=k(i,u,D),W({index:s})):(f=rt()(t,(function(t){return t[c]===u&&t[l]===i})),W({index:f})),null===(n=N.current)||void 0===n||n.flyTo([i,u],N.current.getZoom(),{animate:a});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}i.addLayers(s),N.current.addLayer(i)}if(!C.current)if(G.current=!0,C.current=!0,V&&W({index:0}),o){var g=m().latLngBounds(n.flat().map((function(t){return[t.latitude,t.longitude]})));N.current.fitBounds(g,{padding:[50,50],animate:a})}else{var b,w,S;null===(b=N.current)||void 0===b||b.flyTo([+(null===(w=n[0][0])||void 0===w?void 0:w.latitude),+(null===(S=n[0][0])||void 0===S?void 0:S.longitude)],N.current.getZoom(),{animate:a})}}}),[N.current,D,_.current]);(0,h.useEffect)((function(){if(z){var t=function(){var t=St(bt().mark((function t(){var e;return bt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,z.getValue();case 2:(e=t.sent)&&("entitysel"==z.type?(_.current=e._private.curPage.entitiesDef.map((function(t){return{longitude:t[c],latitude:t[l],popupMessage:t[s]}})),C.current=!1,$(_.current)):(T(e.map((function(t){return{longitude:+j(t,c),latitude:+j(t,l),popupMessage:j(t,s)}}))),C.current=!1,$(D)));case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return t(),z.addListener("changed",t),function(){z.removeListener("changed",t)}}}),[z]),(0,h.useEffect)((function(){if("entitysel"==z.type){var t=function(){var t=St(bt().mark((function t(){var e;return bt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,q(0);case 2:e=t.sent,_.current=e.map((function(t){return mt(mt({},t),{},{longitude:t[c],latitude:t[l],popupMessage:t[s]})})),$(_.current);case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();t()}}),[X]);var Z,W=function(){var t=St(bt().mark((function t(e){var r,n,o,a;return bt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.index,n=e.fireEvent,o=void 0===n||n,z&&V){t.next=3;break}return t.abrupt("return");case 3:t.t0=V.type,t.next="entity"===t.t0?6:"scalar"===t.t0?9:17;break;case 6:return t.next=8,ft({index:r,datasource:z,currentElement:V,fireEvent:o});case 8:case 16:return t.abrupt("break",17);case 9:if("array"===z.dataType){t.next=11;break}return t.abrupt("return");case 11:return t.next=13,z.getValue();case 13:return a=t.sent,t.next=16,V.setValue(null,a[r]);case 17:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Y=(0,h.useCallback)(function(){var t=St(bt().mark((function t(e){var r,n;return bt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&!G.current){t.next=3;break}return G.current=!1,t.abrupt("return");case 3:r="".concat(l," > :1 AND ").concat(l," < :2  AND ").concat(c," > :3 AND ").concat(c," < :4"),n=[e.getSouth().toString(),e.getNorth().toString(),e.getWest().toString(),e.getEast().toString()],K.entitysel({queryString:r,placeholders:n});case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[K,q,X]);return(0,h.useEffect)((function(){$(D)}),[D]),(0,h.useEffect)((function(){if(M.current)return M.current&&(N.current=m().map(M.current,{dragging:i}).setView([51.505,-.09],r,{animate:!1}),M.current.addEventListener("mousedown",(function(t){t.stopPropagation()})),m().tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{}).addTo(N.current),N.current.on("moveend",(function(){var t,e=null===(t=N.current)||void 0===t?void 0:t.getBounds();e&&Y(e)}))),function(){N.current&&(N.current.off(),N.current.remove())}}),[]),(0,h.useEffect)((function(){var t=new ResizeObserver((function(t){var e,r=function(t){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=xt(t))){e&&(t=e);var r=0,n=function(){};return{s:n,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,i=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return a=t.done,t},e:function(t){i=!0,o=t},f:function(){try{a||null==e.return||e.return()}finally{if(i)throw o}}}}(t);try{for(r.s();!(e=r.n()).done;){var n=e.value.contentRect,o=n.width,a=n.height;P({width:o,height:a})}}catch(t){r.e(t)}finally{r.f()}}));return A.current&&t.observe(A.current),function(){A.current&&t.unobserve(A.current)}}),[]),(0,g.jsx)("div",{ref:function(t){w(t),A.current=t},style:p,className:y()(d,b,"flex items-center justify-center  overflow-hidden"),children:(Z=D||_.current,Z.length>=0&&Z.every((function(t){return"object"===S(t)&&"latitude"in t&&"longitude"in t}))?(0,g.jsx)("div",{ref:M,style:mt(mt({},x),{},{zIndex:1})}):(0,g.jsxs)("div",{className:"bg-red-50 border border-red-300 text-red-700 px-4 py-3 rounded-lg shadow-md",role:"alert",children:[(0,g.jsx)("div",{className:"flex items-center",children:(0,g.jsx)("strong",{className:"font-bold text-red-700",children:"Error!"})}),(0,g.jsx)("span",{className:"block sm:inline mt-1 ",children:"Datasource does not match the expected format."})]}))})};function kt(t){return kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kt(t)}function Pt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function At(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Pt(Object(r),!0).forEach((function(e){_t(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Pt(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function _t(t,e,r){return(e=function(t){var e=function(t){if("object"!=kt(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=kt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==kt(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var It=function(t){return(0,n.useEnhancedEditor)((function(t){return{enabled:t.options.enabled}})).enabled?(0,g.jsx)(tt,At({},t)):(0,g.jsx)(jt,At({},t))};It.craft=Q.craft,It.info=Q.info,It.defaultProps=Q.defaultProps;const Dt={SingleMap:B,MultiMap:It}}}]);