# 4d-presentation-2025-07-08

### resources 

* [slides](https://speakerdeck.com/miyako/4d-20-r9)

#### 4D Qoldy Pro - 本番環境対応可 & 顧客成功支援体制

R8からの正式名称は4D Qodly Pro。20  R2のデベロッパープレビュー（2023年9月）から1年半の開発期間およびベータ期間を経て，R8で実際のプロダクションで使用できる水準に到達した。Qodly Studioの開発ライセンスは，シルバー以上のバートナー特典であるDeveloper Proおよびゴールドまたはシルバー拡張特典のDeveloper Bundleライセンスに含まれている。4D Server版のQodly Studioの開発に必要なライセンスは，買い切り版またはサブスク版の4D Server，およびDeveloper Bundleライセンスに含まれている。Qodly Proの運用に必要なライセンスは，買い切り版またはサブスク版の4D Serverに含まれている。

4Dのフォームエディターを使えば，エンドユーザーにとって使いやすい，デスクトップクライアントのアプリケーション画面を手早く開発することができる。Qodly Studioを使えば，4D Serverにアクセスするための新たな手段として，今風の洗練されたレスポンシブなWeb画面を作成することができる。つまり，4D Qodly Proを使えば，同じデータベース・同じアプリケーションに対して，デスクトップクライアントとWeb画面という2通りのアクセスポイントを提供することができる。デスクトップ版のフォームとWeb版のフォームにそれぞれ違うコードを書くのではなく，一度，書いたコードを両方のフォームで利用できる。

Qodlyをはじめてみたいけど，どこから始めたら良いかかわらない：[30分の無料コンサルティング](https://calendly.com/ametwalli/book-a-meeting-with-4d-qodly-pro-success-team)を申し込むことができる。

プロダクションレディに到達したことものの，これでQodlyの開発が終わるわけではない。開発部は，重要なふたつの課題に取り組んでいる。ひとつはORDAイベントを完成させること，もうひとつは国際化に対応すること。ORDAイベントは，レコードアクセスの要であるエンティティオブジェクトを作成してから手放すまで，その
ライフサイクルを最初から最後まで制御できるようにするもの。クラシック言語におけるトリガよりも包括的で，ORDAデータクラスの仕組みと完全にブレンドするような仕組み。

ローカライズについていえば，ローカライズ：どんな4D Qodlyアプリケーションでも，複数の地域と言語に対応させることができるような，使い易くて効率的な方法を開発している。これはQodlyの進化におけるつぎの重要なステップであると認識している。

4D Qodly Proには，ページを組み立てるためのUIコンポーネントが用意されているが，それだけに限定されているわけではない。Qodlyは，独自のUIコンポーネントを自由に追加できるような仕様に作られている。そのようなオリジナルの部品であるカスタムコンポーネントを自分で設計するためにはReactJSのスキルが必要。

[GitHub](https://github.com/qodly/custom-components)には，Qodlyの開発チームが作成したカスタムコンポーネントが多数，公開されているので，それらを活用することもできる。データ表示・フィードバック・レイアウト・入力・ナビゲーションの5つのカテゴリーに整理されている。いずれにしても，UIを自由に拡張できるというのがポイント。前述した顧客成功チームは，この点でも助けを差し伸べることができると考えている。

#### 4D NetKit - OAuth2.0認証のレスポンスをホストWebサーバーのポートで取得

4Dで開発したデスクトップアプリケーションからGoogle WorkspaceやMicrosoft 365が提供するサービスを利用するためには，OAuth2の認証に対応していなければならない。OAuth2の認証に対応するためには，JSON Web Tokenを作成したり，認証トークンを受信できるWebサーバーを公開したり，とったことができなければならない。NetKitは，OAuthサービスとのやりとりに必要な機能をまとめたもの。このコンポーネントには，認証トークンを受信するための簡易Webサーバー機能がついており，Webライセンスがなくても利用できる。

もっとも，すでにWebライセンスを保有しており，アプリケーションをWebで公開しているのであれば，NetKitコンポーネントのWebサーバーではなく，[ホストプロジェクトのWebサーバーで認証トークンを受信](https://blog.4d.com/ja/4d-netkit-use-your-web-server-host-ports-to-retrieve-your-oauth-2-0-authentication-response/)したほうが理にかなっている。redirectURIプロパティにホストプロジェクトのWebサーバーのポート番号を指定するか，ポート番号を省略した場合，認証トークンのコールバック処理にホストのWebサーバー使われる。そうでなければ，NetKitのWebサーバーが使われる。

#### 4D NetKit - カレンダーおよびイベント

20 R9のNetKitを使えば，[Google WorkplaceおよびMicrosoft 365のカレンダーやイベントを取得](https://blog.4d.com/ja/4d-netkit-get-google-and-microsoft-365-calendar-events/)できる。OAuth 2.0でユーザーを認証した後，カレンダーやイベントのデータを取得するためのAPIが用意されている。たとえば，スケジュールを管理したり，直近に迫った予定のリマインダーを表示したりといった用途が考えられる。GoogleとMicrosoftでは，カレンダーやイベントの仕様が異なっているが，ベンダー間の違いをできるかぎりなくすようにコンポーネントが作られているので，シンプルでとても使いやすい。将来のバージョンでは，カレンダーやイベントの取得だけでなく，追加や削除もできるようになる予定。

#### コンポーネントマネージャー - 4Dバージョンに追随

20 R6では，必要なコンポーネントを自動的にインストールするためのプロジェクト依存関係，通称・コンポーネントマネージャーが追加された。20 R7ではコンポーネントの追加と削除が画面上でできるようになり，20 R8では，自動アップデートの設定ができるようになった。20 R9では，自動アップデートをどこまで進めるのか，というルールを決めることができる。

メジャー更新の手前まで，マイナー更新の手前まで，といったルールを定めることができるが，中でも注目したいのは，[4Dバージョンに追随する](https://blog.4d.com/ja/follow-4d-version-a-smarter-way-to-manage-your-dependencies/)，というルール。コンポーネントにこのルールを適用すると，4Dのリリースやバージョンに対応する最新版のコンポーネントが自動的にGitHubからダウンロードされ，インストールされるようになる。

依存関係マネージャーは，GitHubリリースのタグに使われているメジャー・マイナー・パッチ番号を比較して4Dのリリースやバージョンに対応する最新版のコンポーネントを探すようになっている。GitHubに公開されている公式のコンポーネントは，すべてこの振り方を採用しており，サードパーティのコンポーネントも同じようにすれば，4Dバージョンに追随して自動アップデートされるようになる。

#### メソッドエディター - ホストのエディターでコンポーネントのメソッドやクラスを開く

20 R9では，コンポーネントの開発と改修がずっと楽になった。従来のバージョンでは，コンポーネントをほんの少し手直しするだけでも，ホストを閉じてコンポーネントを開き，修正した後にホストを開き直す必要があった。20 R9であれば，[ホストから直接コンポーネントのソースコードをエディターで編集](https://blog.4d.com/ja/edit-and-debug-component-methods-and-classes-in-4d-from-the-host-project/)できる。編集後にプロジェクトを再起動する必要はなく，変更は直ちに反映される。共有ボリュームのプロジェクトを開発モードで開けば，クライアント/サーバー環境でも同じことができる。将来のバージョンでは，メソッドやクラスだけでなく，フォームの編集できるようになる予定。

#### シンタックスチェック - 非推奨ランゲージ要素

20 R9では，非推奨ランゲージ要素，いわゆる廃止予定コマンド等の扱いも改善されている。これまでは"_O_"という接頭辞を追加することで，コマンドや定数が非推奨であることを知らせていた。アンダースコアからはじまるトークンはメソッドエディターのタイプアヘッドにも，VS Codeのコード補完にも候補として表示されない。完全なコマンド名や定数を入力しない限り，"名前が_O_"から始まる非推奨のランゲージ要素を使うことはできなかった。

20 R9では，一歩進んで[そのようなコマンドを使用している箇所にきちんと警告が表示される](https://blog.4d.com/ja/warnings-on-deprecated-language-elements/)ようになった。加えてCommand nameコマンドが拡張され，コマンドが非推奨であるかどうかをチェックできるようなった。今後，非推奨コマンドに"_O_"という接頭辞が追加されることはない。非推奨ランゲージ要素は，その名称に関係なく，コード補完に候補として表示されない。

もちろん，余計な仕事を増やしたり，開発を邪魔したりするためにこのようなことをしているわけではない。ベストプラクティスとされる手法に則ったコーディングを推奨し，進歩に取り残されることがないよう，デベロッパを助けることが目的。いますぐ非推奨コマンドに対応する余裕がなければ，コンパイラー設定で該当する警告を無効化することもできる。

#### ラベルエディター - フォーミュラーエディターを使用

20 R9では，[ラベルエディターからフォーミュラーエディターが表示される](https://blog.4d.com/ja/formulas-in-label-wizard/)ようになった。クリックすすると，フォーミュラーエディターが表示され，数式を挿入することができる。ラベルに配置された数式をダブルクリックすると，再びフォーミュラーエディターが表示され，数式を編集することができる。文字列でコードを自由に入力することができた従来のツールとは違い，標準のフォーミュラーエディターを呼び出すので，許可されていないメソッドやコマンドはブロックされるようになる。

#### ネットワーク - TCPListener クラス

20 R8で追加されたTCPConnectionクラスを使えば，Internet Commandsプラグインを使わずに4DだけでTCPクライアントが構築できるようになった。20 R9では，TCPListenerクラスが追加され，[プラグインを使わずに4DだけでTCPサーバーを構築できる](https://blog.4d.com/ja/new-class-to-handle-incoming-tcp-connections/)ようになった。どちらのクラスもコールバック関数を呼び出すというインタフェース構造になっているため，サーバー側とクライアント側のコードには，かなりの程度，共通点がある。`onConnection`，`onData`，`onError`といったコールバック関数を実装するだけで，本格的なTCPアプリが容易に開発できる。











